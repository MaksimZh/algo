# Оценка сложности операций вставки и удаления элементов динамического массива

[Исходный код](https://github.com/MaksimZh/algo/blob/master/dyn_array/dyn_array.py)

## Вставка элемента в массив
[Метод `DynArray.insert`](https://github.com/MaksimZh/algo/blob/d759ca6996458645acb5726d4dd53e6437050c6c/dyn_array/dyn_array.py#L34-L42)

Оценим среднюю сложность при вставке максимального количества элементов с последующим увеличением ёмкости массива в $x$ раз.
Пусть предыдущая реалокация только произошла, тогда ёмкость массива длины $N + 1$ будет $x N$.
Следующая реаллокация произойдёт после вставки ещё $(x - 1) N$ элементов и сложность копирования всего массива будет $x N$.

### Добавление в конец
При добавлении нового элемента в конец массива копирования не происходит, поэтому сложность вставки будет $1$.
Тогда полная сложность $(x - 1) N$ вставок с реаллокацией будет
$(x - 1) N + x N$.
Поделив эту величину на количество операций получим среднюю сложность вставки, равную
$2 + 1 / (x - 1)$.

То есть сложность вставки элемента в конец массива равна $O(1)$.

### Добавление в произвольное место массива
При вставке нового элемента в произвольное место в массиве все последующие элементы копируются, поэтому сложность такой операции для массива длины $N + 1$ будет в среднем
$(N + 1) / 2 + 1$.
По мере добавления элементов сложность будет расти в арифметической прогрессии, поэтому средняя стоимость вставки составит $(N + 3 + x N + 2) / 4$.
Тогда полная сложность $(x - 1) N$ вставок с последующей реаллокацией составит
$(x - 1) N (N + x N + 5) / 4 + x N$.
Поделив эту величину на количество операций получим среднюю сложность вставки, равную
$N (x + 1) / 4 + 5/4 + 1 / (x - 1)$.

То, что средняя стоимость вставки одного элемента растёт с ростом $x$ выглядит контринтуитивно.
На самом деле здесь фигурирует средняя длина массива равная $N (x + 1) / 2$.
То есть сложность пропорциональна средней длине массива.

В итоге, сложность вставки элемента в произвольное место массива равна $O(N)$.

## Удаление элемента из массива
[Метод `DynArray.delete`](https://github.com/MaksimZh/algo/blob/d759ca6996458645acb5726d4dd53e6437050c6c/dyn_array/dyn_array.py#L44-L50)

При текущей реализации массива реаллокация происходит при любом изменении ёмкости, в том числе и при её уменьшении.

Рассмотрим случай, когда мы удаляем элементы по одному из длинного массива.
Реаллокация массива из $N$ элементов происходит если его ёмкость составляет $f N$.
При этом новая ёмкость будет $y f N$.
После этого для следующей реаллокации размер массива должен уменьшиться до величины $y f^2 N$.
Это потребует $y f (1 - f) N$ операций удаления.

### Удаление последнего элемента
При удалении последнего элемента копирования не происходит, сложность такой операции равна $1$.
Поэтому суммарная сложность $y f (1 - f) N$ операций удаления с последующей реаллокацией составит
$y f (1 - f) N + y f^2 N$ то есть $y f N$.
Тогда средняя сложность одного удаления будет $1 / (1 - f)$.

То есть сложность удаления последнего элемента массива равна $O(1)$.

### Удаление произвольного элемента
При удалении произвольного элемента массива длины $N$ происходит в среднем $N / 2$ операций копирования.
Поэтому средняя сложность одной из $y f (1 - f) N$ операций составит
$y f (1 + f) N / 2 + 1$.
Поэтому суммарная сложность $y f (1 - f) N$ операций удаления с последующей реаллокацией составит
$y f (1 - f) N (y f (1 + f) N / 2 + 1) + y f^2 N$.
Тогда средняя сложность одного удаления будет
$y f (1 + f) N / 2 + 1 + 1 / (1 - f)$.

То есть сложность удаления произвольного элемента массива равна $O(N)$.

